# Habilitar reescritura
RewriteEngine On
RewriteBase /

# =========================
# Seguridad básica / hardening
# =========================

# Evitar listado de directorios
Options -Indexes

# Proteger archivos sensibles (Apache 2.4+)
<IfModule mod_authz_core.c>
  <FilesMatch "\.(env|ini|log|sh|sql|bak|inc|psd|git|htaccess)$">
    Require all denied
  </FilesMatch>
</IfModule>

# =========================
# Ocultar extensiones .php y el index.php en la URL
# =========================

# 1. Redirigir cualquier URL que tenga .php a la versión sin extensión
RewriteCond %{THE_REQUEST} \s([^\s]+)\.php [NC]
RewriteRule ^ %1 [R=301,L]

# 2. Redirigir /index, /index.php o /index/ a /
RewriteCond %{THE_REQUEST} /index(\.php)?[/?\s] [NC]
RewriteRule ^index(\.php)?/?$ / [R=301,L]

# 3. Si existe el archivo sin extensión, reescribir internamente a .php
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME}.php -f
RewriteRule ^(.+?)/?$ $1.php [L]

# =========================
# Redirecciones/Canonicalizaciones específicas
# =========================

# Ejemplo: redirigir /inicio.php a /index.php (usar 302 durante pruebas)
RewriteCond %{THE_REQUEST} \s/inicio\.php[?\s] [NC]
RewriteRule ^inicio\.php$ /index.php [R=302,L]

# =========================
# Manejo de errores
# =========================
ErrorDocument 404 /404.php

# =========================
# Caché y performance
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresDefault "access plus 1 month"
  ExpiresByType text/html "access plus 0 seconds"
  ExpiresByType text/css "access plus 1 month"
  ExpiresByType text/javascript "access plus 1 month"
  ExpiresByType application/javascript "access plus 1 month"
  ExpiresByType image/jpeg "access plus 1 month"
  ExpiresByType image/png "access plus 1 month"
  ExpiresByType image/gif "access plus 1 month"
  ExpiresByType image/svg+xml "access plus 1 month"
</IfModule>

# =========================
# Cabeceras de seguridad
<IfModule mod_headers.c>
  Header set X-Frame-Options "SAMEORIGIN"
  Header set X-Content-Type-Options "nosniff"
  Header set Referrer-Policy "no-referrer-when-downgrade"
</IfModule>
